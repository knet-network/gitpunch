FROM node:8.10-alpine

RUN apk add --no-cache git

RUN mkdir -p /usr/src/app
WORKDIR /usr/src/app

ADD ./node_modules ./node_modules
RUN rm -rf ./node_modules/gitpunch-lib
ADD ./package.json ./package.json
ADD ./package-lock.json ./package-lock.json
RUN npm prune --production
ADD ./lib ./lib
RUN cd node_modules && \
    mv ../lib . && \
    mv lib gitpunch-lib && \
    rm -rf gitpunch-lib/node_modules
